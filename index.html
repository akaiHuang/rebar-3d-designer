<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‹¼ç­‹é…ç­‹ç¹ªè£½ç³»çµ± - Rebar Drawing Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
            overflow: hidden;
            background: #f5f5f5;
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        
        /* é ‚éƒ¨å·¥å…·æ¬„ */
        #toolbar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: #2c3e50;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        #toolbar h1 {
            color: #ecf0f1;
            font-size: 20px;
            margin-right: 30px;
        }
        
        .toolbar-section {
            display: flex;
            align-items: center;
            margin-right: 20px;
            padding-right: 20px;
            border-right: 1px solid #34495e;
        }
        
        .toolbar-section:last-child {
            border-right: none;
        }
        
        .toolbar-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.3s;
        }
        
        .toolbar-btn:hover {
            background: #2980b9;
        }
        
        .toolbar-btn.active {
            background: #e74c3c;
        }
        
        /* å·¦å´å·¥å…·é¢æ¿ */
        #left-panel {
            position: absolute;
            top: 60px;
            left: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 280px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }
        
        .panel-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .panel-section:last-child {
            border-bottom: none;
        }
        
        .panel-section h3 {
            color: #2c3e50;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .control-item {
            margin-bottom: 12px;
        }
        
        .control-item label {
            display: block;
            color: #34495e;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .control-item input[type="number"],
        .control-item select {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .control-item input[type="color"] {
            width: 100%;
            height: 35px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .rebar-type-btn {
            width: 100%;
            padding: 10px;
            margin-bottom: 8px;
            background: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .rebar-type-btn:hover {
            background: #d5dbdb;
        }
        
        .rebar-type-btn.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        /* å³å´å±¬æ€§é¢æ¿ */
        #right-panel {
            position: absolute;
            top: 60px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 300px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }
        
        .rebar-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .rebar-item {
            background: #ecf0f1;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .rebar-item:hover {
            background: #d5dbdb;
        }
        
        .rebar-item.selected {
            background: #3498db;
            color: white;
        }
        
        .rebar-item-title {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 5px;
        }
        
        .rebar-item-info {
            font-size: 11px;
            opacity: 0.8;
        }
        
        /* åº•éƒ¨ç‹€æ…‹æ¬„ */
        #status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #34495e;
            color: #ecf0f1;
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }
        
        .status-item {
            margin-right: 20px;
        }
        
        /* å°è©±æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }
        
        .modal-content h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .modal-buttons button {
            padding: 8px 20px;
            margin-left: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
    </style>
</head>
<body>
    <!-- å·¥å…·æ¬„ -->
    <div id="toolbar">
        <h1>ğŸ—ï¸ é‹¼ç­‹é…ç­‹ç¹ªè£½ç³»çµ±</h1>
        
        <div class="toolbar-section">
            <button class="toolbar-btn" id="newProject">æ–°å»ºå°ˆæ¡ˆ</button>
            <button class="toolbar-btn" id="importDXF">åŒ¯å…¥ DXF</button>
            <button class="toolbar-btn" id="importDWG">åŒ¯å…¥ DWG</button>
            <button class="toolbar-btn" id="saveProject">å„²å­˜</button>
            <button class="toolbar-btn" id="loadProject">è¼‰å…¥</button>
        </div>
        
        <div class="toolbar-section">
            <button class="toolbar-btn" id="exportDXF">åŒ¯å‡º DXF</button>
            <button class="toolbar-btn" id="exportPDF">åŒ¯å‡º PDF</button>
            <button class="toolbar-btn" id="exportImage">åŒ¯å‡ºåœ–ç‰‡</button>
        </div>
        
        <div class="toolbar-section">
            <button class="toolbar-btn" id="undoBtn">å¾©åŸ</button>
            <button class="toolbar-btn" id="redoBtn">é‡åš</button>
            <button class="toolbar-btn" id="deleteBtn">åˆªé™¤</button>
        </div>
        
        <div class="toolbar-section">
            <button class="toolbar-btn" id="viewTop">ä¿¯è¦–åœ–</button>
            <button class="toolbar-btn" id="viewFront">æ­£è¦–åœ–</button>
            <button class="toolbar-btn" id="view3D">3Dè¦–åœ–</button>
        </div>
    </div>
    
    <!-- å·¦å´å·¥å…·é¢æ¿ -->
    <div id="left-panel">
        <div class="panel-section">
            <h3>å»ºç¯‰æ¨¡å‹æ§åˆ¶</h3>
            <div class="control-item">
                <label>æ•´é«”æ¨“é«˜ (mm): <span id="buildingHeightValue">3000</span></label>
                <input type="range" id="buildingHeight" min="100" max="6000" step="100" value="3000">
            </div>
            
            <div class="control-item">
                <label>é¸ä¸­å…ƒç´ é«˜åº¦ (mm): <span id="elementHeightValue">-</span></label>
                <input type="range" id="elementHeight" min="100" max="6000" step="100" value="3000" disabled>
            </div>
            
            <div class="control-item">
                <label>
                    <input type="checkbox" id="show2DPlan" checked> é¡¯ç¤º 2D å¹³é¢åœ–
                </label>
            </div>
            
            <button class="rebar-type-btn" id="applyHeightToAll">å¥—ç”¨é«˜åº¦åˆ°å…¨éƒ¨</button>
        </div>
        
        <div class="panel-section">
            <h3>é‹¼ç­‹é¡å‹</h3>
            <button class="rebar-type-btn active" data-type="straight">ç›´é‹¼ç­‹</button>
            <button class="rebar-type-btn" data-type="stirrup">ç®ç­‹</button>
            <button class="rebar-type-btn" data-type="bent">å½é‰¤é‹¼ç­‹</button>
            <button class="rebar-type-btn" data-type="spiral">èºæ—‹ç­‹</button>
            <button class="rebar-type-btn" data-type="mesh">é‹¼ç­‹ç¶²</button>
        </div>
        
        <div class="panel-section">
            <h3>é‹¼ç­‹è¦æ ¼</h3>
            <div class="control-item">
                <label>é‹¼ç­‹è™Ÿæ•¸ (å…¬ç¨±ç›´å¾‘)</label>
                <select id="rebarSize">
                    <option value="10">D10 (10mm)</option>
                    <option value="13">D13 (12.7mm)</option>
                    <option value="16" selected>D16 (15.9mm)</option>
                    <option value="19">D19 (19.1mm)</option>
                    <option value="22">D22 (22.2mm)</option>
                    <option value="25">D25 (25.4mm)</option>
                    <option value="29">D29 (28.6mm)</option>
                    <option value="32">D32 (32.3mm)</option>
                    <option value="36">D36 (35.8mm)</option>
                </select>
            </div>
            
            <div class="control-item">
                <label>é‹¼ç­‹æè³ª</label>
                <select id="rebarGrade">
                    <option value="SD280">SD280 (2800 kgf/cmÂ²)</option>
                    <option value="SD420" selected>SD420 (4200 kgf/cmÂ²)</option>
                    <option value="SD490">SD490 (4900 kgf/cmÂ²)</option>
                </select>
            </div>
            
            <div class="control-item">
                <label>é•·åº¦ (mm)</label>
                <input type="number" id="rebarLength" value="3000" step="10">
            </div>
            
            <div class="control-item">
                <label>é–“è· (mm)</label>
                <input type="number" id="rebarSpacing" value="150" step="10">
            </div>
            
            <div class="control-item">
                <label>æ•¸é‡</label>
                <input type="number" id="rebarCount" value="10" min="1">
            </div>
        </div>
        
        <div class="panel-section">
            <h3>ä¿è­·å±¤</h3>
            <div class="control-item">
                <label>ä¿è­·å±¤åšåº¦ (mm)</label>
                <input type="number" id="coverThickness" value="40" step="5">
            </div>
        </div>
        
        <div class="panel-section">
            <h3>é¡¯ç¤ºè¨­å®š</h3>
            <div class="control-item">
                <label>é‹¼ç­‹é¡è‰²</label>
                <input type="color" id="rebarColor" value="#ff6b6b">
            </div>
            
            <div class="control-item">
                <label>
                    <input type="checkbox" id="showDimensions" checked> é¡¯ç¤ºæ¨™è¨»
                </label>
            </div>
            
            <div class="control-item">
                <label>
                    <input type="checkbox" id="showGrid" checked> é¡¯ç¤ºç¶²æ ¼
                </label>
            </div>
        </div>
    </div>
    
    <!-- å³å´å±¬æ€§é¢æ¿ -->
    <div id="right-panel">
        <h3>é‹¼ç­‹æ¸…å–®</h3>
        <div class="rebar-list" id="rebarList">
            <!-- å‹•æ…‹ç”Ÿæˆ -->
        </div>
        
        <div class="panel-section">
            <h3>çµ±è¨ˆè³‡è¨Š</h3>
            <div style="font-size: 12px; line-height: 1.8;">
                <div>ç¸½é‹¼ç­‹æ•¸: <strong id="totalCount">0</strong> æ”¯</div>
                <div>ç¸½é•·åº¦: <strong id="totalLength">0</strong> m</div>
                <div>ç¸½é‡é‡: <strong id="totalWeight">0</strong> kg</div>
                <div>æ··å‡åœŸé«”ç©: <strong id="concreteVolume">0</strong> mÂ³</div>
            </div>
        </div>
    </div>
    
    <!-- 3D ç•«å¸ƒ -->
    <div id="canvas-container"></div>
    
    <!-- åº•éƒ¨ç‹€æ…‹æ¬„ -->
    <div id="status-bar">
        <div>
            <span class="status-item">åº§æ¨™: X=<span id="mouseX">0</span>, Y=<span id="mouseY">0</span>, Z=<span id="mouseZ">0</span></span>
            <span class="status-item">è¦–åœ–: <span id="currentView">3Dè¦–åœ–</span></span>
        </div>
        <div>
            <span class="status-item">å°ˆæ¡ˆ: <span id="projectName">æœªå‘½åå°ˆæ¡ˆ</span></span>
            <span class="status-item">å»ºç¯‰: <span id="buildingInfo">æœªåŒ¯å…¥</span></span>
            <span class="status-item" id="saveStatus">æœªå„²å­˜</span>
        </div>
    </div>

    <!-- åŒ¯å…¥æª”æ¡ˆå°è©±æ¡† -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <h2>åŒ¯å…¥ CAD åœ–æª”</h2>
            <p>è«‹é¸æ“‡ DXF æˆ– DWG æª”æ¡ˆï¼ˆå»ºè­°ä½¿ç”¨ DXF æ ¼å¼ï¼‰</p>
            
            <div class="control-item">
                <label>é¸æ“‡æª”æ¡ˆ</label>
                <input type="file" id="fileInput" accept=".dxf,.dwg" style="width: 100%; padding: 10px;">
            </div>
            
            <div class="control-item">
                <label>æ¨“å±¤é«˜åº¦ (mm)</label>
                <input type="number" id="importFloorHeight" value="3000" step="100">
            </div>
            
            <div class="control-item">
                <label>ç‰†é«”åšåº¦ (mm)</label>
                <input type="number" id="importWallThickness" value="200" step="10">
            </div>
            
            <div class="control-item">
                <label>æ¨“æ¿åšåº¦ (mm)</label>
                <input type="number" id="importSlabThickness" value="200" step="10">
            </div>
            
            <div class="modal-buttons">
                <button class="btn-secondary" id="cancelImport">å–æ¶ˆ</button>
                <button class="btn-primary" id="confirmImport">ç¢ºå®šåŒ¯å…¥</button>
            </div>
        </div>
    </div>

    <!-- éš±è—çš„æª”æ¡ˆè¼¸å…¥ -->
    <input type="file" id="hiddenFileInput" accept=".dxf,.dwg" style="display: none;">


    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    
    <script type="module" src="rebar-drawing.js"></script>
</body>
</html>
